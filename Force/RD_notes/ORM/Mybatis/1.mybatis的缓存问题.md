# 1.一级缓存和二级缓存

Mybatis中提供了多级缓存的机制，可以避免因为缓存过期导致的数据不一致的操作。

Mybatis默认提供了两级缓存：

1. 本地缓存：是指SqlSession级别的缓存，即在同一个SqlSession中进行多次查询同一条记录，只会向数据库查询一次，后续的查询会直接从本地缓存中获取。默认开启，且无法关闭。
2. 二级缓存：是指mapper级别的缓存，即在多个SqlSession中共享同一条记录的缓存，可以提高数据的查询效率。默认不开启，需要在mapper.xml文件中添加<cache/>标签启用。

在使用二级缓存时，需要注意以下问题：

1. 被缓存的对象需要实现Serializable接口，以便可以将对象序列化到磁盘中。
2. 对象的更新操作需要触发缓存的失效操作，以避免数据不一致的问题。在mapper.xml中可以通过使用<cache-ref namespace=""/>标签引用其他mapper的缓存来实现缓存的联动更新。
3. 不建议将所有的查询结果都缓存下来，需要根据业务场景进行缓存策略的设计。可以在mapper.xml中通过<cache eviction=""/>标签设置缓存的淘汰策略。

总之，Mybatis的缓存机制可以通过合理的配置和使用，避免因为缓存过期导致的数据不一致的操作。

# 2.分布式系统中如何确保mybatis的缓存机制是有效的？

在分布式系统中，多个实例下使用 Mybatis 缓存机制需要注意以下两个问题：

1. 不同实例之间缓存不一致问题：如果每个实例都缓存自己的数据，那么当一个实例更新了某条数据时，其他实例的缓存中仍然是旧的数据。为了解决这个问题，可以将 Mybatis 缓存放在一个共享的缓存服务器上，比如 Redis。这样，不同的实例就可以共享缓存，缓存数据的一致性也就得到了保证。
2. 缓存的过期问题：Mybatis 缓存是基于时间过期的。如果多个实例的系统时间不同步，那么就可能会出现缓存的过期时间不一致的问题。为了解决这个问题，可以使用一个全局的时间服务器来同步不同实例的时间，或者使用一个基于时钟的服务（比如 ZooKeeper）来保证所有实例的时间一致。

总之，在分布式系统中，要保证 Mybatis 缓存的有效性，需要将缓存放在共享的缓存服务器上，并且保证所有实例的时间同步。

​		**MyBatis的二级缓存需要配置缓存目的地的地址。**

**在MyBatis的配置文件中可以配置缓存类型和缓存目的地的地址，例如可以使用本地内存作为缓存目的地，也可以使用分布式缓存系统如Redis、Memcached等。需要注意的是，MyBatis的二级缓存是跨session的，因此在使用二级缓存时需要考虑缓存的一致性和并发访问的问题。**

